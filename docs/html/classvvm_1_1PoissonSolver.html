<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VVM2D: vvm::PoissonSolver Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VVM2D
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classvvm_1_1PoissonSolver.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classvvm_1_1PoissonSolver-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">vvm::PoissonSolver Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="Declare_8hpp_source.html">Declare.hpp</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for vvm::PoissonSolver:</div>
<div class="dyncontent">
<div class="center"><!-- SVG 0 --></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a5347fcfa9397d38496f70077a3ca8fed" id="r_a5347fcfa9397d38496f70077a3ca8fed"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5347fcfa9397d38496f70077a3ca8fed">InitPoissonMatrix</a> (<a class="el" href="classvvm.html">vvm</a> &amp;model)</td></tr>
<tr class="separator:a5347fcfa9397d38496f70077a3ca8fed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab342116991ca90ab52360e23009c67f3" id="r_ab342116991ca90ab52360e23009c67f3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab342116991ca90ab52360e23009c67f3">cal_w</a> (<a class="el" href="classvvm.html">vvm</a> &amp;, int p=0, int i=0, int j=0)</td></tr>
<tr class="separator:ab342116991ca90ab52360e23009c67f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9cd3bfdd88142ba11cba49029a564ae" id="r_ad9cd3bfdd88142ba11cba49029a564ae"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad9cd3bfdd88142ba11cba49029a564ae">cal_u</a> (<a class="el" href="classvvm.html">vvm</a> &amp;model)</td></tr>
<tr class="separator:ad9cd3bfdd88142ba11cba49029a564ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcc07bc7fb43a3081b2a7d68c8a34782" id="r_abcc07bc7fb43a3081b2a7d68c8a34782"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abcc07bc7fb43a3081b2a7d68c8a34782">pubarTop_pt</a> (<a class="el" href="classvvm.html">vvm</a> &amp;model)</td></tr>
<tr class="separator:abcc07bc7fb43a3081b2a7d68c8a34782"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ade65a218fe6088b4591c6c51a8f13134" id="r_ade65a218fe6088b4591c6c51a8f13134"><td class="memItemLeft" align="right" valign="top">Eigen::SparseMatrix&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ade65a218fe6088b4591c6c51a8f13134">A</a></td></tr>
<tr class="separator:ade65a218fe6088b4591c6c51a8f13134"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa57bc9d4bc2a52dbcd1147afdd621bfc" id="r_aa57bc9d4bc2a52dbcd1147afdd621bfc"><td class="memItemLeft" align="right" valign="top">Eigen::SparseMatrix&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a></td></tr>
<tr class="separator:aa57bc9d4bc2a52dbcd1147afdd621bfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="Declare_8hpp_source.html#l00472">472</a> of file <a class="el" href="Declare_8hpp_source.html">Declare.hpp</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ad9cd3bfdd88142ba11cba49029a564ae" name="ad9cd3bfdd88142ba11cba49029a564ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9cd3bfdd88142ba11cba49029a564ae">&#9670;&#160;</a></span>cal_u()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void vvm::PoissonSolver::cal_u </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvvm.html">vvm</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>model</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="PoissonSolver_8cpp_source.html#l00480">480</a> of file <a class="el" href="PoissonSolver_8cpp_source.html">PoissonSolver.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  480</span>                                       {</div>
<div class="line"><span class="lineno">  481</span><span class="preprocessor">    #if defined(PETSC)</span></div>
<div class="line"><span class="lineno">  482</span>        Vec y, h;</div>
<div class="line"><span class="lineno">  483</span>        Mat <a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>;</div>
<div class="line"><span class="lineno">  484</span>        KSP ksp;</div>
<div class="line"><span class="lineno">  485</span>       </div>
<div class="line"><span class="lineno">  486</span>        <span class="keywordtype">int</span> j[3];</div>
<div class="line"><span class="lineno">  487</span>        <span class="keywordtype">double</span> v[3];</div>
<div class="line"><span class="lineno">  488</span>        </div>
<div class="line"><span class="lineno">  489</span>        PetscInt m = model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2;</div>
<div class="line"><span class="lineno">  490</span>    </div>
<div class="line"><span class="lineno">  491</span>        <span class="comment">// Create vectors</span></div>
<div class="line"><span class="lineno">  492</span>        VecCreate(PETSC_COMM_WORLD, &amp;y);</div>
<div class="line"><span class="lineno">  493</span>        VecSetSizes(y, PETSC_DECIDE, m);</div>
<div class="line"><span class="lineno">  494</span>        VecSetFromOptions(y);</div>
<div class="line"><span class="lineno">  495</span>        VecDuplicate(y, &amp;h);</div>
<div class="line"><span class="lineno">  496</span><span class="preprocessor">        #if defined(POISSONTEST)</span></div>
<div class="line"><span class="lineno">  497</span>            Vec y_ans;</div>
<div class="line"><span class="lineno">  498</span>            VecDuplicate(y, &amp;y_ans);</div>
<div class="line"><span class="lineno">  499</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno">  500</span> </div>
<div class="line"><span class="lineno">  501</span>        <span class="comment">// Create the matrix</span></div>
<div class="line"><span class="lineno">  502</span>        MatCreate(PETSC_COMM_WORLD, &amp;<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>);</div>
<div class="line"><span class="lineno">  503</span>        MatSetSizes(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>, PETSC_DECIDE, PETSC_DECIDE, m, m);</div>
<div class="line"><span class="lineno">  504</span>        MatSetFromOptions(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>);</div>
<div class="line"><span class="lineno">  505</span>        MatSetUp(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>);</div>
<div class="line"><span class="lineno">  506</span> </div>
<div class="line"><span class="lineno">  507</span>        <span class="keywordtype">int</span> startind = 0, endind = 0;</div>
<div class="line"><span class="lineno">  508</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  509</span>            <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><span class="lineno">  510</span>                <span class="comment">// v[0] = -2.*model.rdx2 + POISSONPARAMU; v[1] = 1.*model.rdx2; v[2] = 1.*model.rdx2;</span></div>
<div class="line"><span class="lineno">  511</span>                v[0] = -2. + model.POISSONPARAMU; v[1] = 1.; v[2] = 1.;</div>
<div class="line"><span class="lineno">  512</span>                j[0] = 0; j[1] = 1; j[2] = (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)-1;</div>
<div class="line"><span class="lineno">  513</span>                MatSetValues(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>, 1, &amp;i, 3, j, v, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  514</span>            }</div>
<div class="line"><span class="lineno">  515</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)-1) {</div>
<div class="line"><span class="lineno">  516</span>                <span class="comment">// v[0] = 1.*model.rdx2; v[1] = 1.*model.rdx2; v[2] = -2.*model.rdx2 + POISSONPARAMU;</span></div>
<div class="line"><span class="lineno">  517</span>                v[0] = 1.; v[1] = 1.; v[2] = -2. + model.POISSONPARAMU;</div>
<div class="line"><span class="lineno">  518</span>                j[0] = 0; j[1] = (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)-2; j[2] = (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)-1;</div>
<div class="line"><span class="lineno">  519</span>                MatSetValues(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>, 1, &amp;i, 3, j, v, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  520</span>            }</div>
<div class="line"><span class="lineno">  521</span>            <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  522</span>                <span class="comment">// v[0] = 1.*model.rdx2; v[1] = -2.*model.rdx2 + POISSONPARAMU; v[2] = 1.*model.rdx2;</span></div>
<div class="line"><span class="lineno">  523</span>                v[0] = 1.; v[1] = -2. + model.POISSONPARAMU; v[2] = 1.;</div>
<div class="line"><span class="lineno">  524</span>                j[0] = i-1; j[1] = i; j[2] = i+1;</div>
<div class="line"><span class="lineno">  525</span>                MatSetValues(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>, 1, &amp;i, 3, j, v, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  526</span>            }</div>
<div class="line"><span class="lineno">  527</span> </div>
<div class="line"><span class="lineno">  528</span><span class="preprocessor">            #if defined(POISSONTEST)</span></div>
<div class="line"><span class="lineno">  529</span>                <span class="keywordtype">double</span> y_ansval = exp(sin(i*i));</div>
<div class="line"><span class="lineno">  530</span>                VecSetValues(y_ans, 1, &amp;i, &amp;y_ansval, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  531</span><span class="preprocessor">            #else</span></div>
<div class="line"><span class="lineno">  532</span>                <span class="comment">// double hval = -(0. - model.rhow[model.nz-2] * model.w[i+1][model.nz-2]) / model.rhou[model.nz-2] * model.rdz;</span></div>
<div class="line"><span class="lineno">  533</span>                <span class="keywordtype">double</span> hval = -(0. - model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2] * model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i+1][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2]) / model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2] * model.<a class="code hl_variable" href="classvvm.html#aa10689462c2d23ff7514d71e1b44f272">dz</a>;</div>
<div class="line"><span class="lineno">  534</span>                VecSetValues(h, 1, &amp;i, &amp;hval, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  535</span><span class="preprocessor">            #endif</span></div>
<div class="line"><span class="lineno">  536</span>        }</div>
<div class="line"><span class="lineno">  537</span>        MatAssemblyBegin(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>, MAT_FINAL_ASSEMBLY); MatAssemblyEnd(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>, MAT_FINAL_ASSEMBLY);</div>
<div class="line"><span class="lineno">  538</span>        VecAssemblyBegin(h); VecAssemblyEnd(h);</div>
<div class="line"><span class="lineno">  539</span>        <span class="comment">// MatView(G, PETSC_VIEWER_STDOUT_WORLD);</span></div>
<div class="line"><span class="lineno">  540</span>        <span class="comment">// VecView(b, PETSC_VIEWER_STDOUT_WORLD);</span></div>
<div class="line"><span class="lineno">  541</span><span class="preprocessor">        #if defined(POISSONTEST)</span></div>
<div class="line"><span class="lineno">  542</span>            VecAssemblyBegin(y_ans); VecAssemblyEnd(y_ans);</div>
<div class="line"><span class="lineno">  543</span>            MatMult(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>, y_ans, h);</div>
<div class="line"><span class="lineno">  544</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno">  545</span> </div>
<div class="line"><span class="lineno">  546</span>        KSPCreate(PETSC_COMM_WORLD, &amp;ksp);</div>
<div class="line"><span class="lineno">  547</span>        KSPSetOperators(ksp, <a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>, <a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>);</div>
<div class="line"><span class="lineno">  548</span>        KSPSetFromOptions(ksp);</div>
<div class="line"><span class="lineno">  549</span>        KSPSetTolerances(ksp, 1E-15, 1E-9, 1E2, 10000);</div>
<div class="line"><span class="lineno">  550</span>        KSPSolve(ksp, h, y);</div>
<div class="line"><span class="lineno">  551</span>        <span class="comment">// VecView(x, PETSC_VIEWER_STDOUT_WORLD);</span></div>
<div class="line"><span class="lineno">  552</span> </div>
<div class="line"><span class="lineno">  553</span><span class="preprocessor">        #if defined(POISSONTEST)</span></div>
<div class="line"><span class="lineno">  554</span>            <span class="keywordtype">double</span> error_norm;</div>
<div class="line"><span class="lineno">  555</span>            VecAXPY(y, -1, y_ans);</div>
<div class="line"><span class="lineno">  556</span>            VecNorm(y, NORM_2, &amp;error_norm);</div>
<div class="line"><span class="lineno">  557</span>            printf(<span class="stringliteral">&quot;Grid %d: Error = %1e\n&quot;</span>, m, error_norm);</div>
<div class="line"><span class="lineno">  558</span><span class="preprocessor">        #else</span></div>
<div class="line"><span class="lineno">  559</span>            PetscScalar *<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>;</div>
<div class="line"><span class="lineno">  560</span>            VecGetArray(y, &amp;<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>);</div>
<div class="line"><span class="lineno">  561</span> </div>
<div class="line"><span class="lineno">  562</span>            <span class="keywordflow">for</span> (PetscInt i = 0; i &lt; model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  563</span>                model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[i+1] = <a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[i];</div>
<div class="line"><span class="lineno">  564</span>            }</div>
<div class="line"><span class="lineno">  565</span>            model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[0] = model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2];</div>
<div class="line"><span class="lineno">  566</span>            model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-1] = model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[1];</div>
<div class="line"><span class="lineno">  567</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno">  568</span> </div>
<div class="line"><span class="lineno">  569</span>        <span class="keywordtype">int</span> iterNum = 0.;</div>
<div class="line"><span class="lineno">  570</span>        <span class="keywordtype">double</span> normError = 0.;</div>
<div class="line"><span class="lineno">  571</span>        KSPGetIterationNumber(ksp, &amp;iterNum);</div>
<div class="line"><span class="lineno">  572</span>        KSPGetResidualNorm(ksp, &amp;normError);</div>
<div class="line"><span class="lineno">  573</span>        printf(<span class="stringliteral">&quot;Solving u: Norm of error = %1e, Iterations = %d\n&quot;</span>, normError, iterNum);</div>
<div class="line"><span class="lineno">  574</span> </div>
<div class="line"><span class="lineno">  575</span>        MatDestroy(&amp;<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>);</div>
<div class="line"><span class="lineno">  576</span>        VecDestroy(&amp;h);</div>
<div class="line"><span class="lineno">  577</span>        VecDestroy(&amp;y);</div>
<div class="line"><span class="lineno">  578</span>        KSPDestroy(&amp;ksp);</div>
<div class="line"><span class="lineno">  579</span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="lineno">  580</span>        Eigen::VectorXd y(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2), h(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2);</div>
<div class="line"><span class="lineno">  581</span> </div>
<div class="line"><span class="lineno">  582</span>        <span class="comment">// h</span></div>
<div class="line"><span class="lineno">  583</span>        <span class="keywordtype">double</span> tmp = 0.;</div>
<div class="line"><span class="lineno">  584</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  585</span>            h(i-1) = -(0. - model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2] * model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2]) / model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2] * model.<a class="code hl_variable" href="classvvm.html#a2caed43a215a43912fe28e2170ac2cd0">dx</a>;</div>
<div class="line"><span class="lineno">  586</span>            tmp += h(i-1);</div>
<div class="line"><span class="lineno">  587</span>        }</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>        <span class="comment">// h = h - \bar{h} =&gt; Because it&#39;s periodic boundary condition, we need to subtract the average value to confine the solution.</span></div>
<div class="line"><span class="lineno">  590</span>        tmp /= (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2);</div>
<div class="line"><span class="lineno">  591</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  592</span>            h(i-1) = h(i-1) - tmp;</div>
<div class="line"><span class="lineno">  593</span>        }</div>
<div class="line"><span class="lineno">  594</span> </div>
<div class="line"><span class="lineno">  595</span>        Eigen::SparseMatrix&lt;double&gt; <a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a> = model.<a class="code hl_variable" href="classvvm.html#a2b0b1a4ac6932d797805238e973cc01d">G</a>;</div>
<div class="line"><span class="lineno">  596</span>        Eigen::ConjugateGradient&lt;Eigen::SparseMatrix&lt;double&gt;, Eigen::Lower|Eigen::Upper, Eigen::IdentityPreconditioner&gt; solver_xi;</div>
<div class="line"><span class="lineno">  597</span>        <span class="comment">// Eigen::BiCGSTAB&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver_xi;</span></div>
<div class="line"><span class="lineno">  598</span>        <span class="comment">// Eigen::SimplicialLDLT&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver_xi;</span></div>
<div class="line"><span class="lineno">  599</span>        <span class="comment">// solver_xi.setTolerance(model.tolerance);</span></div>
<div class="line"><span class="lineno">  600</span>        solver_xi.setTolerance(1E-12);</div>
<div class="line"><span class="lineno">  601</span>        solver_xi.setMaxIterations(10000);</div>
<div class="line"><span class="lineno">  602</span>        solver_xi.compute(<a class="code hl_variable" href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">G</a>);</div>
<div class="line"><span class="lineno">  603</span>        <span class="keywordflow">if</span> (solver_xi.info() != Eigen::Success) {</div>
<div class="line"><span class="lineno">  604</span>            std::cout &lt;&lt; <span class="stringliteral">&quot;UUUUUUUU Warning!!!!!!!!!!!!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  605</span>        }</div>
<div class="line"><span class="lineno">  606</span>        y = solver_xi.solve(h);</div>
<div class="line"><span class="lineno">  607</span>        <span class="keywordflow">if</span> (solver_xi.info() != Eigen::Success) {</div>
<div class="line"><span class="lineno">  608</span>            std::cout &lt;&lt; <span class="stringliteral">&quot;U Solve Warning!!!!!!!!!!!!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  609</span>            std::cout &lt;&lt; <span class="stringliteral">&quot;U:  #iterations:     &quot;</span> &lt;&lt; solver_xi.iterations() &lt;&lt; <span class="stringliteral">&quot;, estimated error: &quot;</span> &lt;&lt; std::scientific &lt;&lt;  solver_xi.error() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  610</span>        }</div>
<div class="line"><span class="lineno">  611</span> </div>
<div class="line"><span class="lineno">  612</span>        <span class="comment">// xi</span></div>
<div class="line"><span class="lineno">  613</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  614</span>            model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[i] = y[i-1];</div>
<div class="line"><span class="lineno">  615</span>        }</div>
<div class="line"><span class="lineno">  616</span>        model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[0] = model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2];</div>
<div class="line"><span class="lineno">  617</span>        model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-1] = model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[1];</div>
<div class="line"><span class="lineno">  618</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  619</span> </div>
<div class="line"><span class="lineno">  620</span>    <span class="comment">// uxi</span></div>
<div class="line"><span class="lineno">  621</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  622</span>        model.<a class="code hl_variable" href="classvvm.html#a98ca1a57c5f80276c967f8f576c9f05c">uxi</a>[i] = (model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[i] - model.<a class="code hl_variable" href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">xi</a>[i-1]) * model.<a class="code hl_variable" href="classvvm.html#a3ca267ed2f973f92e35d839085baf702">rdx</a>;</div>
<div class="line"><span class="lineno">  623</span>    }</div>
<div class="line"><span class="lineno">  624</span>    model.<a class="code hl_variable" href="classvvm.html#a98ca1a57c5f80276c967f8f576c9f05c">uxi</a>[0] = model.<a class="code hl_variable" href="classvvm.html#a98ca1a57c5f80276c967f8f576c9f05c">uxi</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2];</div>
<div class="line"><span class="lineno">  625</span>    model.<a class="code hl_variable" href="classvvm.html#a98ca1a57c5f80276c967f8f576c9f05c">uxi</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-1] = model.<a class="code hl_variable" href="classvvm.html#a98ca1a57c5f80276c967f8f576c9f05c">uxi</a>[1];</div>
<div class="line"><span class="lineno">  626</span> </div>
<div class="line"><span class="lineno">  627</span>    <span class="comment">// u_top</span></div>
<div class="line"><span class="lineno">  628</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  629</span>        model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2] = model.<a class="code hl_variable" href="classvvm.html#a98ca1a57c5f80276c967f8f576c9f05c">uxi</a>[i] + model.<a class="code hl_variable" href="classvvm.html#a2494ade44221bcd3aed164d73bf208f4">ubarTopp</a>;</div>
<div class="line"><span class="lineno">  630</span>    }</div>
<div class="line"><span class="lineno">  631</span>    model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[0][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2] = model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2];</div>
<div class="line"><span class="lineno">  632</span>    model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-1][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2] = model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[1][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2];</div>
<div class="line"><span class="lineno">  633</span> </div>
<div class="line"><span class="lineno">  634</span>    <span class="comment">// u</span></div>
<div class="line"><span class="lineno">  635</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  636</span>        <span class="keywordtype">double</span> area = 0.;</div>
<div class="line"><span class="lineno">  637</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3; k &gt;= 1; k--) {</div>
<div class="line"><span class="lineno">  638</span>            area += ((model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i][k+1]-model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i-1][k+1]) * model.<a class="code hl_variable" href="classvvm.html#a3ca267ed2f973f92e35d839085baf702">rdx</a> - model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k+1]*model.<a class="code hl_variable" href="classvvm.html#a44e87b0393bbb303fe26c12b4defc572">zetap</a>[i][k+1]) * -model.<a class="code hl_variable" href="classvvm.html#aa10689462c2d23ff7514d71e1b44f272">dz</a>;</div>
<div class="line"><span class="lineno">  639</span>            model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[i][k] = area + model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2];</div>
<div class="line"><span class="lineno">  640</span>        }</div>
<div class="line"><span class="lineno">  641</span>    }</div>
<div class="line"><span class="lineno">  642</span>    model.<a class="code hl_function" href="classvvm.html#a26777567d798e7a46a54a9adc5d7242f">BoundaryProcess2D_center</a>(model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>, model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>, model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>);</div>
<div class="line"><span class="lineno">  643</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  644</span>}</div>
<div class="ttc" id="aclassvvm_1_1PoissonSolver_html_aa57bc9d4bc2a52dbcd1147afdd621bfc"><div class="ttname"><a href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">vvm::PoissonSolver::G</a></div><div class="ttdeci">Eigen::SparseMatrix&lt; double &gt; G</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00476">Declare.hpp:476</a></div></div>
<div class="ttc" id="aclassvvm_html_a03a120f9647d1b680a8552a1743f47bf"><div class="ttname"><a href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">vvm::w</a></div><div class="ttdeci">double ** w</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00330">Declare.hpp:330</a></div></div>
<div class="ttc" id="aclassvvm_html_a1ac0d1c50fc3935a312b6f667a1c34c0"><div class="ttname"><a href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">vvm::u</a></div><div class="ttdeci">double ** u</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00329">Declare.hpp:329</a></div></div>
<div class="ttc" id="aclassvvm_html_a1c19d7dc2ab861379c3c69c7e79bd5c8"><div class="ttname"><a href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">vvm::nz</a></div><div class="ttdeci">int nz</div><div class="ttdoc">Number of grid points in z direction, calculated from Config_VVM given by users.</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00274">Declare.hpp:274</a></div></div>
<div class="ttc" id="aclassvvm_html_a2494ade44221bcd3aed164d73bf208f4"><div class="ttname"><a href="classvvm.html#a2494ade44221bcd3aed164d73bf208f4">vvm::ubarTopp</a></div><div class="ttdeci">double ubarTopp</div><div class="ttdoc">The top boundary of the zonal wind for future time step. In the model design part,...</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00301">Declare.hpp:301</a></div></div>
<div class="ttc" id="aclassvvm_html_a26777567d798e7a46a54a9adc5d7242f"><div class="ttname"><a href="classvvm.html#a26777567d798e7a46a54a9adc5d7242f">vvm::BoundaryProcess2D_center</a></div><div class="ttdeci">static void BoundaryProcess2D_center(double **var, int nx, int nz)</div><div class="ttdef"><b>Definition</b> <a href="Boundary_8cpp_source.html#l00009">Boundary.cpp:9</a></div></div>
<div class="ttc" id="aclassvvm_html_a2b0b1a4ac6932d797805238e973cc01d"><div class="ttname"><a href="classvvm.html#a2b0b1a4ac6932d797805238e973cc01d">vvm::G</a></div><div class="ttdeci">Eigen::SparseMatrix&lt; double &gt; G</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00469">Declare.hpp:469</a></div></div>
<div class="ttc" id="aclassvvm_html_a2caed43a215a43912fe28e2170ac2cd0"><div class="ttname"><a href="classvvm.html#a2caed43a215a43912fe28e2170ac2cd0">vvm::dx</a></div><div class="ttdeci">double dx</div><div class="ttdoc">From Config_VVM given by users.</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00277">Declare.hpp:277</a></div></div>
<div class="ttc" id="aclassvvm_html_a3ca267ed2f973f92e35d839085baf702"><div class="ttname"><a href="classvvm.html#a3ca267ed2f973f92e35d839085baf702">vvm::rdx</a></div><div class="ttdeci">double rdx</div><div class="ttdoc">1/dx, calculated from Config_VVM given by users.</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00267">Declare.hpp:267</a></div></div>
<div class="ttc" id="aclassvvm_html_a44e87b0393bbb303fe26c12b4defc572"><div class="ttname"><a href="classvvm.html#a44e87b0393bbb303fe26c12b4defc572">vvm::zetap</a></div><div class="ttdeci">double ** zetap</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00323">Declare.hpp:323</a></div></div>
<div class="ttc" id="aclassvvm_html_a54019773003b18a98f267df45ee230bb"><div class="ttname"><a href="classvvm.html#a54019773003b18a98f267df45ee230bb">vvm::nx</a></div><div class="ttdeci">int nx</div><div class="ttdoc">Number of grid points in x direction, calculated from Config_VVM given by users.</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00273">Declare.hpp:273</a></div></div>
<div class="ttc" id="aclassvvm_html_a7edff5662fbdb8df0fe3094a6ab3efb7"><div class="ttname"><a href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">vvm::rhow</a></div><div class="ttdeci">double * rhow</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00310">Declare.hpp:310</a></div></div>
<div class="ttc" id="aclassvvm_html_a98ca1a57c5f80276c967f8f576c9f05c"><div class="ttname"><a href="classvvm.html#a98ca1a57c5f80276c967f8f576c9f05c">vvm::uxi</a></div><div class="ttdeci">double * uxi</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00316">Declare.hpp:316</a></div></div>
<div class="ttc" id="aclassvvm_html_aa10689462c2d23ff7514d71e1b44f272"><div class="ttname"><a href="classvvm.html#aa10689462c2d23ff7514d71e1b44f272">vvm::dz</a></div><div class="ttdeci">double dz</div><div class="ttdoc">From Config_VVM given by users.</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00278">Declare.hpp:278</a></div></div>
<div class="ttc" id="aclassvvm_html_acbca6aac8347f4edda14c1c6e3e22f14"><div class="ttname"><a href="classvvm.html#acbca6aac8347f4edda14c1c6e3e22f14">vvm::xi</a></div><div class="ttdeci">double * xi</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00315">Declare.hpp:315</a></div></div>
<div class="ttc" id="aclassvvm_html_af25e3367c5ad1d011c15ff7d774a0abf"><div class="ttname"><a href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">vvm::rhou</a></div><div class="ttdeci">double * rhou</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00309">Declare.hpp:309</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><!-- SVG 1 --></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><!-- SVG 2 --></div>
</div>

</div>
</div>
<a id="ab342116991ca90ab52360e23009c67f3" name="ab342116991ca90ab52360e23009c67f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab342116991ca90ab52360e23009c67f3">&#9670;&#160;</a></span>cal_w()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void vvm::PoissonSolver::cal_w </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvvm.html">vvm</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>model</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>p</em><span class="paramdefsep"> = </span><span class="paramdefval">0</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>i</em><span class="paramdefsep"> = </span><span class="paramdefval">0</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>j</em><span class="paramdefsep"> = </span><span class="paramdefval">0</span></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="PoissonSolver_8cpp_source.html#l00186">186</a> of file <a class="el" href="PoissonSolver_8cpp_source.html">PoissonSolver.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  186</span>                                                            {</div>
<div class="line"><span class="lineno">  187</span><span class="preprocessor">    #if defined(PETSC) </span></div>
<div class="line"><span class="lineno">  188</span>        Vec x, b;</div>
<div class="line"><span class="lineno">  189</span>        Mat <a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>;</div>
<div class="line"><span class="lineno">  190</span>        KSP ksp;</div>
<div class="line"><span class="lineno">  191</span>       </div>
<div class="line"><span class="lineno">  192</span>        <span class="keywordtype">int</span> j[5];</div>
<div class="line"><span class="lineno">  193</span>        <span class="keywordtype">double</span> v[5];</div>
<div class="line"><span class="lineno">  194</span>        </div>
<div class="line"><span class="lineno">  195</span>        PetscInt m = (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3);</div>
<div class="line"><span class="lineno">  196</span>    </div>
<div class="line"><span class="lineno">  197</span>        <span class="comment">// Create vectors</span></div>
<div class="line"><span class="lineno">  198</span>        VecCreate(PETSC_COMM_WORLD, &amp;x);</div>
<div class="line"><span class="lineno">  199</span>        VecSetSizes(x, PETSC_DECIDE, m);</div>
<div class="line"><span class="lineno">  200</span>        VecSetFromOptions(x);</div>
<div class="line"><span class="lineno">  201</span>        VecDuplicate(x, &amp;b);</div>
<div class="line"><span class="lineno">  202</span><span class="preprocessor">        #if defined(POISSONTEST)</span></div>
<div class="line"><span class="lineno">  203</span>            Vec x_ans;</div>
<div class="line"><span class="lineno">  204</span>            VecDuplicate(x, &amp;x_ans);</div>
<div class="line"><span class="lineno">  205</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno">  206</span> </div>
<div class="line"><span class="lineno">  207</span>        <span class="comment">// Create the matrix</span></div>
<div class="line"><span class="lineno">  208</span>        MatCreate(PETSC_COMM_WORLD, &amp;<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>);</div>
<div class="line"><span class="lineno">  209</span>        MatSetSizes(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, PETSC_DECIDE, PETSC_DECIDE, m, m);</div>
<div class="line"><span class="lineno">  210</span>        MatSetFromOptions(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>);</div>
<div class="line"><span class="lineno">  211</span>        MatSetUp(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>);</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>        <span class="keywordtype">int</span> idx_i = 0, k = 1;</div>
<div class="line"><span class="lineno">  214</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3); i++) {    </div>
<div class="line"><span class="lineno">  215</span>            <span class="comment">// Height</span></div>
<div class="line"><span class="lineno">  216</span>            <span class="keywordflow">if</span> (i % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == 0) k++;</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span>            <span class="comment">// Diagonal</span></div>
<div class="line"><span class="lineno">  219</span>            <span class="comment">// v[0] = -(2. + (model.rhow[k]/model.rhou[k]) + (model.rhow[k]/model.rhou[k-1])) * model.rdx2 + model.POISSONPARAMW;</span></div>
<div class="line"><span class="lineno">  220</span>            v[0] = -(2. + (model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]/model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k]) + (model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]/model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k-1])) + model.POISSONPARAMW;</div>
<div class="line"><span class="lineno">  221</span>            j[0] = i;</div>
<div class="line"><span class="lineno">  222</span>            MatSetValues(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, 1, &amp;i, 1, j, v, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>            </div>
<div class="line"><span class="lineno">  225</span>            <span class="comment">// D</span></div>
<div class="line"><span class="lineno">  226</span>            <span class="comment">// Fill left right except the point near the boundaries</span></div>
<div class="line"><span class="lineno">  227</span>            <span class="keywordflow">if</span> (i % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) != 0 &amp;&amp; i % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) != (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)-1) {</div>
<div class="line"><span class="lineno">  228</span>                <span class="comment">// v[0] = 1.*model.rdx2; v[1] = 1.*model.rdx2; </span></div>
<div class="line"><span class="lineno">  229</span>                v[0] = 1.; v[1] = 1.; </div>
<div class="line"><span class="lineno">  230</span>                j[0] = i-1; j[1] = i+1;</div>
<div class="line"><span class="lineno">  231</span>                MatSetValues(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, 1, &amp;i, 2, j, v, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  232</span>            }</div>
<div class="line"><span class="lineno">  233</span>            <span class="comment">// Fill the leftest point</span></div>
<div class="line"><span class="lineno">  234</span>            <span class="keywordflow">if</span> (i % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == 0) {</div>
<div class="line"><span class="lineno">  235</span>                <span class="comment">// v[0] = 1.*model.rdx2; v[1] = 1.*model.rdx2;</span></div>
<div class="line"><span class="lineno">  236</span>                v[0] = 1.; v[1] = 1.;</div>
<div class="line"><span class="lineno">  237</span>                j[0] = i+1, j[1] = i+(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)-1;</div>
<div class="line"><span class="lineno">  238</span>                MatSetValues(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, 1, &amp;i, 2, j, v, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  239</span>            }</div>
<div class="line"><span class="lineno">  240</span>        </div>
<div class="line"><span class="lineno">  241</span>            <span class="comment">// Fill the rightest point</span></div>
<div class="line"><span class="lineno">  242</span>            <span class="keywordflow">if</span> (i % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)-1) {</div>
<div class="line"><span class="lineno">  243</span>                <span class="comment">// v[0] = 1.*model.rdx2; v[1] = 1.*model.rdx2;</span></div>
<div class="line"><span class="lineno">  244</span>                v[0] = 1.; v[1] = 1.;</div>
<div class="line"><span class="lineno">  245</span>                j[0] = i-(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)+1, j[1] = i-1;</div>
<div class="line"><span class="lineno">  246</span>                MatSetValues(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, 1, &amp;i, 2, j, v, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  247</span>            }</div>
<div class="line"><span class="lineno">  248</span>            </div>
<div class="line"><span class="lineno">  249</span>            <span class="comment">// E</span></div>
<div class="line"><span class="lineno">  250</span>            <span class="keywordflow">if</span> (i &lt; (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3-1)) {</div>
<div class="line"><span class="lineno">  251</span>                <span class="comment">// v[0] = model.rhow[k]/model.rhou[k] * model.rdx2;</span></div>
<div class="line"><span class="lineno">  252</span>                v[0] = model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]/model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k];</div>
<div class="line"><span class="lineno">  253</span>                j[0] = i+(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2);</div>
<div class="line"><span class="lineno">  254</span>                MatSetValues(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, 1, &amp;i, 1, j, v, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  255</span>            }</div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>            <span class="comment">// F</span></div>
<div class="line"><span class="lineno">  258</span>            <span class="keywordflow">if</span> (i &gt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) {</div>
<div class="line"><span class="lineno">  259</span>                <span class="comment">// v[0] = model.rhow[k]/model.rhou[k-1] * model.rdx2;</span></div>
<div class="line"><span class="lineno">  260</span>                v[0] = model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]/model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k-1];</div>
<div class="line"><span class="lineno">  261</span>                j[0] = i-(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2);</div>
<div class="line"><span class="lineno">  262</span>                MatSetValues(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, 1, &amp;i, 1, j, v, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  263</span>            }</div>
<div class="line"><span class="lineno">  264</span>            </div>
<div class="line"><span class="lineno">  265</span><span class="preprocessor">            #if defined(POISSONTEST)</span></div>
<div class="line"><span class="lineno">  266</span>                <span class="keywordtype">double</span> x_ansval = exp(sin(i));</div>
<div class="line"><span class="lineno">  267</span>                VecSetValues(x_ans, 1, &amp;i, &amp;x_ansval, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  268</span><span class="preprocessor">            #else</span></div>
<div class="line"><span class="lineno">  269</span>                idx_i = (i % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)) + 1;</div>
<div class="line"><span class="lineno">  270</span>                <span class="comment">// double bval = model.rhow[k]*model.rhow[k] * (model.zetap[idx_i+1][k] - model.zetap[idx_i][k]) * model.rdx;</span></div>
<div class="line"><span class="lineno">  271</span>                <span class="keywordtype">double</span> bval = model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]*model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k] * (model.<a class="code hl_variable" href="classvvm.html#a44e87b0393bbb303fe26c12b4defc572">zetap</a>[idx_i+1][k] - model.<a class="code hl_variable" href="classvvm.html#a44e87b0393bbb303fe26c12b4defc572">zetap</a>[idx_i][k]) * model.<a class="code hl_variable" href="classvvm.html#a2caed43a215a43912fe28e2170ac2cd0">dx</a>;</div>
<div class="line"><span class="lineno">  272</span>                VecSetValues(b, 1, &amp;i, &amp;bval, INSERT_VALUES);</div>
<div class="line"><span class="lineno">  273</span><span class="preprocessor">            #endif</span></div>
<div class="line"><span class="lineno">  274</span>        }</div>
<div class="line"><span class="lineno">  275</span> </div>
<div class="line"><span class="lineno">  276</span>        MatAssemblyBegin(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, MAT_FINAL_ASSEMBLY); MatAssemblyEnd(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, MAT_FINAL_ASSEMBLY);</div>
<div class="line"><span class="lineno">  277</span>        VecAssemblyBegin(b); VecAssemblyEnd(b);</div>
<div class="line"><span class="lineno">  278</span>        <span class="comment">// MatView(A, PETSC_VIEWER_STDOUT_WORLD);</span></div>
<div class="line"><span class="lineno">  279</span>        <span class="comment">// VecView(b, PETSC_VIEWER_STDOUT_WORLD);</span></div>
<div class="line"><span class="lineno">  280</span><span class="preprocessor">        #if defined(POISSONTEST)</span></div>
<div class="line"><span class="lineno">  281</span>            VecAssemblyBegin(x_ans); VecAssemblyEnd(x_ans);</div>
<div class="line"><span class="lineno">  282</span>            MatMult(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, x_ans, b);</div>
<div class="line"><span class="lineno">  283</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>        KSPCreate(PETSC_COMM_WORLD, &amp;ksp);</div>
<div class="line"><span class="lineno">  286</span>        KSPSetOperators(ksp, <a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>, <a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>);</div>
<div class="line"><span class="lineno">  287</span>        KSPSetFromOptions(ksp);</div>
<div class="line"><span class="lineno">  288</span>        KSPSetTolerances(ksp, 1E-30, 1E-12, 1E2, 10000);</div>
<div class="line"><span class="lineno">  289</span>        KSPSolve(ksp, b, x);</div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span><span class="preprocessor">        #if defined(POISSONTEST)</span></div>
<div class="line"><span class="lineno">  292</span>            <span class="keywordtype">double</span> error_norm;</div>
<div class="line"><span class="lineno">  293</span>            VecAXPY(x, -1, x_ans);</div>
<div class="line"><span class="lineno">  294</span>            VecNorm(x, NORM_2, &amp;error_norm);</div>
<div class="line"><span class="lineno">  295</span>            printf(<span class="stringliteral">&quot;Grid %d: Error = %1e\n&quot;</span>, m, error_norm);</div>
<div class="line"><span class="lineno">  296</span><span class="preprocessor">        #else</span></div>
<div class="line"><span class="lineno">  297</span>            PetscScalar *x_arr;</div>
<div class="line"><span class="lineno">  298</span>            VecGetArray(x, &amp;x_arr);</div>
<div class="line"><span class="lineno">  299</span>            </div>
<div class="line"><span class="lineno">  300</span>            <span class="keywordtype">int</span> K = 1;</div>
<div class="line"><span class="lineno">  301</span>            <span class="keywordtype">int</span> I = 0;</div>
<div class="line"><span class="lineno">  302</span>            <span class="keywordflow">for</span> (PetscInt i = 0; i &lt; m; i++) {</div>
<div class="line"><span class="lineno">  303</span>                I = (i % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)) + 1;</div>
<div class="line"><span class="lineno">  304</span>                <span class="keywordflow">if</span> (i % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == 0) K++;</div>
<div class="line"><span class="lineno">  305</span>                model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[I][K] = x_arr[i] / model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[K];</div>
<div class="line"><span class="lineno">  306</span>            }</div>
<div class="line"><span class="lineno">  307</span> </div>
<div class="line"><span class="lineno">  308</span>            </div>
<div class="line"><span class="lineno">  309</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 1; k &lt;= model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2; k++) {</div>
<div class="line"><span class="lineno">  310</span>                model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[0][k] = model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2][k];</div>
<div class="line"><span class="lineno">  311</span>                model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-1][k] = model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[1][k];</div>
<div class="line"><span class="lineno">  312</span>            }</div>
<div class="line"><span class="lineno">  313</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-1; i++) {</div>
<div class="line"><span class="lineno">  314</span>                model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i][0] = model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i][1] = model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-1] = 0.;</div>
<div class="line"><span class="lineno">  315</span>            }</div>
<div class="line"><span class="lineno">  316</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno">  317</span>        <span class="keywordtype">int</span> iterNum = 0.;</div>
<div class="line"><span class="lineno">  318</span>        <span class="keywordtype">double</span> normError = 0.;</div>
<div class="line"><span class="lineno">  319</span>        KSPGetIterationNumber(ksp, &amp;iterNum);</div>
<div class="line"><span class="lineno">  320</span>        KSPGetResidualNorm(ksp, &amp;normError);</div>
<div class="line"><span class="lineno">  321</span>        printf(<span class="stringliteral">&quot;Solving w: Norm of error = %1e, Iterations = %d\n&quot;</span>, normError, iterNum);</div>
<div class="line"><span class="lineno">  322</span> </div>
<div class="line"><span class="lineno">  323</span>        MatDestroy(&amp;<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>);</div>
<div class="line"><span class="lineno">  324</span>        VecDestroy(&amp;b);</div>
<div class="line"><span class="lineno">  325</span>        VecDestroy(&amp;x);</div>
<div class="line"><span class="lineno">  326</span>        KSPDestroy(&amp;ksp);</div>
<div class="line"><span class="lineno">  327</span>        </div>
<div class="line"><span class="lineno">  328</span>        <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  329</span><span class="comment">        // The petsc here is using the DMDA to allocate the matrix so it&#39;s intrinsically parallel by petsc</span></div>
<div class="line"><span class="lineno">  330</span><span class="comment">        DM da;</span></div>
<div class="line"><span class="lineno">  331</span><span class="comment">        Vec xx, bb;</span></div>
<div class="line"><span class="lineno">  332</span><span class="comment">        Mat AA;</span></div>
<div class="line"><span class="lineno">  333</span><span class="comment">        KSP ksp;</span></div>
<div class="line"><span class="lineno">  334</span><span class="comment">        PetscLogStage stage;</span></div>
<div class="line"><span class="lineno">  335</span><span class="comment">        DMDALocalInfo info;</span></div>
<div class="line"><span class="lineno">  336</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  337</span><span class="comment">        PetscInt nx = model.nx - 2;</span></div>
<div class="line"><span class="lineno">  338</span><span class="comment">        PetscInt nz = model.nz - 3;</span></div>
<div class="line"><span class="lineno">  339</span><span class="comment">        PetscInt m = nx * nz;</span></div>
<div class="line"><span class="lineno">  340</span><span class="comment">        PetscInt i, j, its;</span></div>
<div class="line"><span class="lineno">  341</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  342</span><span class="comment">        PetscFunctionBegin;</span></div>
<div class="line"><span class="lineno">  343</span><span class="comment">        PetscCallVoid(DMDACreate2d(PETSC_COMM_WORLD, DM_BOUNDARY_PERIODIC, DM_BOUNDARY_NONE, DMDA_STENCIL_STAR, nx, nz, PETSC_DECIDE, PETSC_DECIDE, 1, 1, NULL, NULL, &amp;da));</span></div>
<div class="line"><span class="lineno">  344</span><span class="comment">        PetscCallVoid(DMSetFromOptions(da));</span></div>
<div class="line"><span class="lineno">  345</span><span class="comment">        PetscCallVoid(DMSetUp(da));</span></div>
<div class="line"><span class="lineno">  346</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  347</span><span class="comment">        PetscCallVoid(DMCreateMatrix(da, &amp;AA));</span></div>
<div class="line"><span class="lineno">  348</span><span class="comment">        PetscCallVoid(DMCreateGlobalVector(da, &amp;bb));</span></div>
<div class="line"><span class="lineno">  349</span><span class="comment">        PetscCallVoid(VecDuplicate(bb, &amp;xx));</span></div>
<div class="line"><span class="lineno">  350</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  351</span><span class="comment">        // PetscLogStageRegister(&quot;Assembly&quot;, &amp;stage);</span></div>
<div class="line"><span class="lineno">  352</span><span class="comment">        // PetscLogStagePush(stage);</span></div>
<div class="line"><span class="lineno">  353</span><span class="comment">        PetscCallVoid(DMDAGetLocalInfo(da, &amp;info));</span></div>
<div class="line"><span class="lineno">  354</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  355</span><span class="comment">        for (j = info.ys; j &lt; info.ys + info.ym; j++) {</span></div>
<div class="line"><span class="lineno">  356</span><span class="comment">            for (i = info.xs; i &lt; info.xs + info.xm; i++) {</span></div>
<div class="line"><span class="lineno">  357</span><span class="comment">                MatStencil  row = {0}, col[5] = {{0}};</span></div>
<div class="line"><span class="lineno">  358</span><span class="comment">                PetscScalar v[5];</span></div>
<div class="line"><span class="lineno">  359</span><span class="comment">                PetscInt    ncols = 0;</span></div>
<div class="line"><span class="lineno">  360</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  361</span><span class="comment">                row.j             = j;</span></div>
<div class="line"><span class="lineno">  362</span><span class="comment">                row.i             = i;</span></div>
<div class="line"><span class="lineno">  363</span><span class="comment">                col[ncols].j      = j;</span></div>
<div class="line"><span class="lineno">  364</span><span class="comment">                col[ncols].i      = i;</span></div>
<div class="line"><span class="lineno">  365</span><span class="comment">                v[ncols++]        = -(2. + (model.rhow[j+2]/model.rhou[j+2]) + (model.rhow[j+2]/model.rhou[j+1])) + model.POISSONPARAMW;</span></div>
<div class="line"><span class="lineno">  366</span><span class="comment">                // boundaries </span></div>
<div class="line"><span class="lineno">  367</span><span class="comment">                // D left-off</span></div>
<div class="line"><span class="lineno">  368</span><span class="comment">                if (i &gt; 0) {</span></div>
<div class="line"><span class="lineno">  369</span><span class="comment">                    col[ncols].j = j;</span></div>
<div class="line"><span class="lineno">  370</span><span class="comment">                    col[ncols].i = i - 1;</span></div>
<div class="line"><span class="lineno">  371</span><span class="comment">                    v[ncols++]   = 1.;</span></div>
<div class="line"><span class="lineno">  372</span><span class="comment">                }</span></div>
<div class="line"><span class="lineno">  373</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  374</span><span class="comment">                // D right-off</span></div>
<div class="line"><span class="lineno">  375</span><span class="comment">                if (i &lt; info.mx - 1) {</span></div>
<div class="line"><span class="lineno">  376</span><span class="comment">                    col[ncols].j = j;</span></div>
<div class="line"><span class="lineno">  377</span><span class="comment">                    col[ncols].i = i + 1;</span></div>
<div class="line"><span class="lineno">  378</span><span class="comment">                    v[ncols++]   = 1.;</span></div>
<div class="line"><span class="lineno">  379</span><span class="comment">                }</span></div>
<div class="line"><span class="lineno">  380</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  381</span><span class="comment">                // D periodic upright</span></div>
<div class="line"><span class="lineno">  382</span><span class="comment">                if (i % info.mx == 0) {</span></div>
<div class="line"><span class="lineno">  383</span><span class="comment">                    col[ncols].j = j;</span></div>
<div class="line"><span class="lineno">  384</span><span class="comment">                    col[ncols].i = i + info.mx - 1;</span></div>
<div class="line"><span class="lineno">  385</span><span class="comment">                    v[ncols++]   = 1.;</span></div>
<div class="line"><span class="lineno">  386</span><span class="comment">                }</span></div>
<div class="line"><span class="lineno">  387</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  388</span><span class="comment">                // D periodic downleft</span></div>
<div class="line"><span class="lineno">  389</span><span class="comment">                if (i % info.mx == info.mx - 1) {</span></div>
<div class="line"><span class="lineno">  390</span><span class="comment">                    col[ncols].j = j;</span></div>
<div class="line"><span class="lineno">  391</span><span class="comment">                    col[ncols].i = i - info.mx + 1;</span></div>
<div class="line"><span class="lineno">  392</span><span class="comment">                    v[ncols++]   = 1.;</span></div>
<div class="line"><span class="lineno">  393</span><span class="comment">                }</span></div>
<div class="line"><span class="lineno">  394</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  395</span><span class="comment">                // F</span></div>
<div class="line"><span class="lineno">  396</span><span class="comment">                if (j &gt; 0) {</span></div>
<div class="line"><span class="lineno">  397</span><span class="comment">                    col[ncols].j = j - 1;</span></div>
<div class="line"><span class="lineno">  398</span><span class="comment">                    col[ncols].i = i;</span></div>
<div class="line"><span class="lineno">  399</span><span class="comment">                    v[ncols++]   = model.rhow[j+2]/model.rhou[j+1];</span></div>
<div class="line"><span class="lineno">  400</span><span class="comment">                }</span></div>
<div class="line"><span class="lineno">  401</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  402</span><span class="comment">                // E</span></div>
<div class="line"><span class="lineno">  403</span><span class="comment">                if (j &lt; info.my - 1) {</span></div>
<div class="line"><span class="lineno">  404</span><span class="comment">                    col[ncols].j = j + 1;</span></div>
<div class="line"><span class="lineno">  405</span><span class="comment">                    col[ncols].i = i;</span></div>
<div class="line"><span class="lineno">  406</span><span class="comment">                    v[ncols++]   = model.rhow[j+2]/model.rhou[j+2];;</span></div>
<div class="line"><span class="lineno">  407</span><span class="comment">                }</span></div>
<div class="line"><span class="lineno">  408</span><span class="comment">                PetscCallVoid(MatSetValuesStencil(AA, 1, &amp;row, ncols, col, v, INSERT_VALUES));</span></div>
<div class="line"><span class="lineno">  409</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  410</span><span class="comment">                PetscInt idx   = i + j * info.mx;</span></div>
<div class="line"><span class="lineno">  411</span><span class="comment">                // printf(&quot;idx = %d\n&quot;, idx);</span></div>
<div class="line"><span class="lineno">  412</span><span class="comment">                double bval = model.rhow[j+2]*model.rhow[j+2] * (model.zetap[i+2][j+2] - model.zetap[i+1][j+2]) * model.dx;</span></div>
<div class="line"><span class="lineno">  413</span><span class="comment">                PetscCallVoid(VecSetValue(bb, idx, bval, INSERT_VALUES));</span></div>
<div class="line"><span class="lineno">  414</span><span class="comment">            }</span></div>
<div class="line"><span class="lineno">  415</span><span class="comment">        }</span></div>
<div class="line"><span class="lineno">  416</span><span class="comment">        PetscCallVoid(MatAssemblyBegin(AA, MAT_FINAL_ASSEMBLY));</span></div>
<div class="line"><span class="lineno">  417</span><span class="comment">        PetscCallVoid(MatAssemblyEnd(AA, MAT_FINAL_ASSEMBLY));</span></div>
<div class="line"><span class="lineno">  418</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  419</span><span class="comment">        PetscCallVoid(VecAssemblyBegin(bb));</span></div>
<div class="line"><span class="lineno">  420</span><span class="comment">        PetscCallVoid(VecAssemblyEnd(bb));</span></div>
<div class="line"><span class="lineno">  421</span><span class="comment">        // PetscLogStagePop();</span></div>
<div class="line"><span class="lineno">  422</span><span class="comment">        </span></div>
<div class="line"><span class="lineno">  423</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  424</span><span class="comment">        PetscCallVoid(KSPCreate(PETSC_COMM_WORLD, &amp;ksp));</span></div>
<div class="line"><span class="lineno">  425</span><span class="comment">        PetscCallVoid(KSPSetOperators(ksp, AA, AA));</span></div>
<div class="line"><span class="lineno">  426</span><span class="comment">        PetscCallVoid(KSPSetFromOptions(ksp));</span></div>
<div class="line"><span class="lineno">  427</span><span class="comment">        PetscCallVoid(KSPSetTolerances(ksp, 1E-30, 1E-12, 1E2, 10000));</span></div>
<div class="line"><span class="lineno">  428</span><span class="comment">        PetscCallVoid(KSPSolve(ksp, bb, xx));</span></div>
<div class="line"><span class="lineno">  429</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  430</span><span class="comment">        // PetscBool      isEqual;</span></div>
<div class="line"><span class="lineno">  431</span><span class="comment">        // MatEqual(A, AA, &amp;isEqual);</span></div>
<div class="line"><span class="lineno">  432</span><span class="comment">        // printf(&quot;Is A equal to AA? %d\n&quot;, isEqual);</span></div>
<div class="line"><span class="lineno">  433</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  434</span><span class="comment">        // PetscBool      isEqual2;</span></div>
<div class="line"><span class="lineno">  435</span><span class="comment">        // VecEqual(b, bb, &amp;isEqual2);</span></div>
<div class="line"><span class="lineno">  436</span><span class="comment">        // printf(&quot;Is x equal to xx? %d\n&quot;, isEqual2);</span></div>
<div class="line"><span class="lineno">  437</span><span class="comment">        */</span></div>
<div class="line"><span class="lineno">  438</span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="lineno">  439</span>        <span class="comment">// eigen solver</span></div>
<div class="line"><span class="lineno">  440</span>        Eigen::VectorXd x((model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3)), b((model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3));</div>
<div class="line"><span class="lineno">  441</span>    </div>
<div class="line"><span class="lineno">  442</span>        <span class="comment">// b</span></div>
<div class="line"><span class="lineno">  443</span>        <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><span class="lineno">  444</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 2; k &lt;= model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2; k++) {</div>
<div class="line"><span class="lineno">  445</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  446</span>                b(count) = model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]*model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k] * (model.<a class="code hl_variable" href="classvvm.html#a44e87b0393bbb303fe26c12b4defc572">zetap</a>[i+1][k] - model.<a class="code hl_variable" href="classvvm.html#a44e87b0393bbb303fe26c12b4defc572">zetap</a>[i][k]) * model.<a class="code hl_variable" href="classvvm.html#a2caed43a215a43912fe28e2170ac2cd0">dx</a>;</div>
<div class="line"><span class="lineno">  447</span>                count++;</div>
<div class="line"><span class="lineno">  448</span>            }</div>
<div class="line"><span class="lineno">  449</span>        }</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>        <span class="comment">// Eigen::SimplicialLDLT&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver;</span></div>
<div class="line"><span class="lineno">  452</span>        Eigen::BiCGSTAB&lt;Eigen::SparseMatrix&lt;double&gt;, Eigen::IncompleteLUT&lt;double&gt; &gt; solver;</div>
<div class="line"><span class="lineno">  453</span>        <span class="comment">// Eigen::ConjugateGradient&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver;</span></div>
<div class="line"><span class="lineno">  454</span>        solver.setTolerance(model.<a class="code hl_variable" href="classvvm.html#a3e2abf1ec43319d4963b18ee9c942279">tolerance</a>);</div>
<div class="line"><span class="lineno">  455</span>        solver.setMaxIterations(10000);</div>
<div class="line"><span class="lineno">  456</span>        Eigen::SparseMatrix&lt;double&gt; <a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a> = model.<a class="code hl_variable" href="classvvm.html#ac87ca230e4801653418101e80a986b5b">A</a>;</div>
<div class="line"><span class="lineno">  457</span>        solver.compute(<a class="code hl_variable" href="#ade65a218fe6088b4591c6c51a8f13134">A</a>);</div>
<div class="line"><span class="lineno">  458</span>        <span class="keywordflow">if</span> (solver.info() != Eigen::Success) {</div>
<div class="line"><span class="lineno">  459</span>            std::cout &lt;&lt; <span class="stringliteral">&quot;WWWWWWWWW Warning!!!!!!!!!!!!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  460</span>        }</div>
<div class="line"><span class="lineno">  461</span>        x = solver.solve(b);</div>
<div class="line"><span class="lineno">  462</span>        <span class="keywordflow">if</span> (solver.info() != Eigen::Success) {</div>
<div class="line"><span class="lineno">  463</span>            printf(<span class="stringliteral">&quot;p, i, j = %d, %d, %d\n&quot;</span>, p, i, j);</div>
<div class="line"><span class="lineno">  464</span>            std::cout &lt;&lt; <span class="stringliteral">&quot;W Solve Warning!!!!!!!!!!!!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  465</span>            std::cout &lt;&lt; <span class="stringliteral">&quot;W:  #iterations:     &quot;</span> &lt;&lt; solver.iterations() &lt;&lt; <span class="stringliteral">&quot;, estimated error: &quot;</span> &lt;&lt; std::scientific &lt;&lt;  solver.error() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  466</span>        }</div>
<div class="line"><span class="lineno">  467</span>    </div>
<div class="line"><span class="lineno">  468</span>        <span class="keywordtype">int</span> cnt = 0;</div>
<div class="line"><span class="lineno">  469</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 2; k &lt;= model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2; k++) {</div>
<div class="line"><span class="lineno">  470</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2; i++) {</div>
<div class="line"><span class="lineno">  471</span>                model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i][k] = x[cnt] / model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k];</div>
<div class="line"><span class="lineno">  472</span>                cnt++;</div>
<div class="line"><span class="lineno">  473</span>            }</div>
<div class="line"><span class="lineno">  474</span>        }</div>
<div class="line"><span class="lineno">  475</span>        model.<a class="code hl_function" href="classvvm.html#ac41a46f58ad272f540b96ad68895f88d">BoundaryProcess2D_westdown</a>(model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>, model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>, model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>);</div>
<div class="line"><span class="lineno">  476</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  477</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  478</span>}</div>
<div class="ttc" id="aclassvvm_1_1PoissonSolver_html_ade65a218fe6088b4591c6c51a8f13134"><div class="ttname"><a href="#ade65a218fe6088b4591c6c51a8f13134">vvm::PoissonSolver::A</a></div><div class="ttdeci">Eigen::SparseMatrix&lt; double &gt; A</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00475">Declare.hpp:475</a></div></div>
<div class="ttc" id="aclassvvm_html_a3e2abf1ec43319d4963b18ee9c942279"><div class="ttname"><a href="classvvm.html#a3e2abf1ec43319d4963b18ee9c942279">vvm::tolerance</a></div><div class="ttdeci">double tolerance</div><div class="ttdoc">From Config_VVM given by users.</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00288">Declare.hpp:288</a></div></div>
<div class="ttc" id="aclassvvm_html_ac41a46f58ad272f540b96ad68895f88d"><div class="ttname"><a href="classvvm.html#ac41a46f58ad272f540b96ad68895f88d">vvm::BoundaryProcess2D_westdown</a></div><div class="ttdeci">static void BoundaryProcess2D_westdown(double **var, int nx, int nz)</div><div class="ttdef"><b>Definition</b> <a href="Boundary_8cpp_source.html#l00021">Boundary.cpp:21</a></div></div>
<div class="ttc" id="aclassvvm_html_ac87ca230e4801653418101e80a986b5b"><div class="ttname"><a href="classvvm.html#ac87ca230e4801653418101e80a986b5b">vvm::A</a></div><div class="ttdeci">Eigen::SparseMatrix&lt; double &gt; A</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00468">Declare.hpp:468</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><!-- SVG 3 --></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><!-- SVG 4 --></div>
</div>

</div>
</div>
<a id="a5347fcfa9397d38496f70077a3ca8fed" name="a5347fcfa9397d38496f70077a3ca8fed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5347fcfa9397d38496f70077a3ca8fed">&#9670;&#160;</a></span>InitPoissonMatrix()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void vvm::PoissonSolver::InitPoissonMatrix </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvvm.html">vvm</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>model</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="PoissonSolver_8cpp_source.html#l00663">663</a> of file <a class="el" href="PoissonSolver_8cpp_source.html">PoissonSolver.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  663</span>                                                   {</div>
<div class="line"><span class="lineno">  664</span><span class="preprocessor">    #if defined(STREAMFUNCTION)</span></div>
<div class="line"><span class="lineno">  665</span>        <span class="keyword">typedef</span> Eigen::Triplet&lt;double&gt; T;</div>
<div class="line"><span class="lineno">  666</span>        <span class="comment">// ###########################################</span></div>
<div class="line"><span class="lineno">  667</span>        <span class="comment">// For solving w</span></div>
<div class="line"><span class="lineno">  668</span>        <span class="comment">// A: i = 1~model.nx-2, k = 2~model.nz-2</span></div>
<div class="line"><span class="lineno">  669</span>        <span class="comment">// ###########################################</span></div>
<div class="line"><span class="lineno">  670</span>        <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  671</span><span class="comment">        int k = 1;</span></div>
<div class="line"><span class="lineno">  672</span><span class="comment">        std::vector&lt;T&gt; coeff;</span></div>
<div class="line"><span class="lineno">  673</span><span class="comment">        for (int idx = 1; idx &lt; (model.nx-2)*(model.nz-3); idx++) {</span></div>
<div class="line"><span class="lineno">  674</span><span class="comment">            // Height</span></div>
<div class="line"><span class="lineno">  675</span><span class="comment">            if (idx % (model.nx-2) == 1) k++;</span></div>
<div class="line"><span class="lineno">  676</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  677</span><span class="comment">            // D</span></div>
<div class="line"><span class="lineno">  678</span><span class="comment">            coeff.push_back(T(idx-1, idx-1, -4.));</span></div>
<div class="line"><span class="lineno">  679</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  680</span><span class="comment">            // left/right: -1</span></div>
<div class="line"><span class="lineno">  681</span><span class="comment">            if ((idx-1) % (model.nx-2) != 0) coeff.push_back(T(idx-1, idx-2, 1.));</span></div>
<div class="line"><span class="lineno">  682</span><span class="comment">            if (idx % (model.nx-2) != 0) coeff.push_back(T(idx-1, idx, 1.));</span></div>
<div class="line"><span class="lineno">  683</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  684</span><span class="comment">            // Boundary</span></div>
<div class="line"><span class="lineno">  685</span><span class="comment">            if ((idx-1) % (model.nx-2) == 0) {</span></div>
<div class="line"><span class="lineno">  686</span><span class="comment">                coeff.push_back(T(idx-1, idx-1+(model.nx-3), 1.));</span></div>
<div class="line"><span class="lineno">  687</span><span class="comment">                coeff.push_back(T(idx-1+(model.nx-3), idx-1, 1.));</span></div>
<div class="line"><span class="lineno">  688</span><span class="comment">            }</span></div>
<div class="line"><span class="lineno">  689</span><span class="comment">        }</span></div>
<div class="line"><span class="lineno">  690</span><span class="comment">        // Last row of A</span></div>
<div class="line"><span class="lineno">  691</span><span class="comment">        coeff.push_back(T((model.nx-2)*(model.nz-3)-1, (model.nx-2)*(model.nz-3)-1, -4.));</span></div>
<div class="line"><span class="lineno">  692</span><span class="comment">        coeff.push_back(T((model.nx-2)*(model.nz-3)-1, (model.nx-2)*(model.nz-3)-1-1, 1.)); // left</span></div>
<div class="line"><span class="lineno">  693</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  694</span><span class="comment">        k = 1;</span></div>
<div class="line"><span class="lineno">  695</span><span class="comment">        for (int idx = 1; idx &lt;= (model.nx-2)*(model.nz-4); idx++) {</span></div>
<div class="line"><span class="lineno">  696</span><span class="comment">            // Height</span></div>
<div class="line"><span class="lineno">  697</span><span class="comment">            if (idx % (model.nx-2) == 1) k++;</span></div>
<div class="line"><span class="lineno">  698</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  699</span><span class="comment">            // E</span></div>
<div class="line"><span class="lineno">  700</span><span class="comment">            coeff.push_back(T(idx-1, idx+(model.nx-2)-1, 1. + 0.5*(model.rhou[k] - model.rhou[k-1]) / model.rhow[k]));</span></div>
<div class="line"><span class="lineno">  701</span><span class="comment">            </span></div>
<div class="line"><span class="lineno">  702</span><span class="comment">            // F (the k of row should be minus by 1 because it starts from k-1)</span></div>
<div class="line"><span class="lineno">  703</span><span class="comment">            coeff.push_back(T(idx+(model.nx-2)-1, idx-1, 1. - 0.5*(model.rhou[k] - model.rhou[k-1]) / model.rhow[k]));</span></div>
<div class="line"><span class="lineno">  704</span><span class="comment">        }</span></div>
<div class="line"><span class="lineno">  705</span><span class="comment">        */</span></div>
<div class="line"><span class="lineno">  706</span> </div>
<div class="line"><span class="lineno">  707</span> </div>
<div class="line"><span class="lineno">  708</span>        std::vector&lt;T&gt; coeff;</div>
<div class="line"><span class="lineno">  709</span>        <span class="keywordtype">int</span> k = 1; </div>
<div class="line"><span class="lineno">  710</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0; idx &lt; (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3); idx++) {</div>
<div class="line"><span class="lineno">  711</span>            <span class="comment">// Height</span></div>
<div class="line"><span class="lineno">  712</span>            <span class="keywordflow">if</span> (idx % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == 0) k++;</div>
<div class="line"><span class="lineno">  713</span> </div>
<div class="line"><span class="lineno">  714</span>            coeff.push_back(T(idx, idx, -2./model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k] - (1./model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k] + 1./model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k-1]) + POISSONPARAM ));</div>
<div class="line"><span class="lineno">  715</span> </div>
<div class="line"><span class="lineno">  716</span>            <span class="comment">// left/right = 1</span></div>
<div class="line"><span class="lineno">  717</span>            <span class="keywordflow">if</span> (idx % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) != 0) coeff.push_back(T(idx, idx-1, 1./model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k])); <span class="comment">// left</span></div>
<div class="line"><span class="lineno">  718</span>            <span class="keywordflow">if</span> ((idx+1) % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) != 0) coeff.push_back(T(idx, idx+1, 1./model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k])); <span class="comment">// right</span></div>
<div class="line"><span class="lineno">  719</span> </div>
<div class="line"><span class="lineno">  720</span>            <span class="comment">// Boundary</span></div>
<div class="line"><span class="lineno">  721</span>            <span class="keywordflow">if</span> (idx % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == 0) {</div>
<div class="line"><span class="lineno">  722</span>                coeff.push_back(T(idx, idx+(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-3), 1./model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]));</div>
<div class="line"><span class="lineno">  723</span>                coeff.push_back(T(idx+(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-3), idx, 1./model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]));</div>
<div class="line"><span class="lineno">  724</span>            }</div>
<div class="line"><span class="lineno">  725</span>        }</div>
<div class="line"><span class="lineno">  726</span>        </div>
<div class="line"><span class="lineno">  727</span>        k = 1;</div>
<div class="line"><span class="lineno">  728</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0; idx &lt; (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3); idx++) {</div>
<div class="line"><span class="lineno">  729</span>            <span class="comment">// Height</span></div>
<div class="line"><span class="lineno">  730</span>            <span class="keywordflow">if</span> (idx % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == 0) k++;</div>
<div class="line"><span class="lineno">  731</span> </div>
<div class="line"><span class="lineno">  732</span>            <span class="comment">// E</span></div>
<div class="line"><span class="lineno">  733</span>            <span class="keywordflow">if</span> (idx &lt; (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-4)) coeff.push_back(T(idx, idx+(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2), 1./model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k]));</div>
<div class="line"><span class="lineno">  734</span>            </div>
<div class="line"><span class="lineno">  735</span>            <span class="comment">// F</span></div>
<div class="line"><span class="lineno">  736</span>            <span class="keywordflow">if</span> (idx &gt;= (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)) coeff.push_back(T(idx, idx-(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2), 1./model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k-1]));</div>
<div class="line"><span class="lineno">  737</span>        }</div>
<div class="line"><span class="lineno">  738</span>        model.<a class="code hl_variable" href="classvvm.html#ac87ca230e4801653418101e80a986b5b">A</a>.setFromTriplets(coeff.begin(), coeff.end());</div>
<div class="line"><span class="lineno">  739</span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="lineno">  740</span> </div>
<div class="line"><span class="lineno">  741</span> </div>
<div class="line"><span class="lineno">  742</span>    <span class="comment">// ###########################################</span></div>
<div class="line"><span class="lineno">  743</span>    <span class="comment">// For solving w</span></div>
<div class="line"><span class="lineno">  744</span>    <span class="comment">// A: i = 1~model.nx-2, k = 1~model.nz-3</span></div>
<div class="line"><span class="lineno">  745</span>    <span class="comment">// ###########################################</span></div>
<div class="line"><span class="lineno">  746</span>    <span class="keyword">typedef</span> Eigen::Triplet&lt;double&gt; T;</div>
<div class="line"><span class="lineno">  747</span>    std::vector&lt;T&gt; coeff;</div>
<div class="line"><span class="lineno">  748</span>    <span class="keywordtype">int</span> k = 1; </div>
<div class="line"><span class="lineno">  749</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0; idx &lt; (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3); idx++) {</div>
<div class="line"><span class="lineno">  750</span>        <span class="comment">// Height</span></div>
<div class="line"><span class="lineno">  751</span>        <span class="keywordflow">if</span> (idx % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == 0) k++;</div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span>        coeff.push_back(T(idx, idx, -(2. + (model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]/model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k]) + (model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]/model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k-1])) + model.POISSONPARAMW ));</div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>        <span class="comment">// left/right = 1</span></div>
<div class="line"><span class="lineno">  756</span>        <span class="keywordflow">if</span> (idx % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) != 0) coeff.push_back(T(idx, idx-1, 1.)); <span class="comment">// left</span></div>
<div class="line"><span class="lineno">  757</span>        <span class="keywordflow">if</span> ((idx+1) % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) != 0) coeff.push_back(T(idx, idx+1, 1.)); <span class="comment">// right</span></div>
<div class="line"><span class="lineno">  758</span> </div>
<div class="line"><span class="lineno">  759</span>        <span class="comment">// Boundary</span></div>
<div class="line"><span class="lineno">  760</span>        <span class="keywordflow">if</span> (idx % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == 0) {</div>
<div class="line"><span class="lineno">  761</span>            coeff.push_back(T(idx, idx+(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-3), 1.));</div>
<div class="line"><span class="lineno">  762</span>            coeff.push_back(T(idx+(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-3), idx, 1.));</div>
<div class="line"><span class="lineno">  763</span>        }</div>
<div class="line"><span class="lineno">  764</span>    }</div>
<div class="line"><span class="lineno">  765</span>    </div>
<div class="line"><span class="lineno">  766</span>    k = 1;</div>
<div class="line"><span class="lineno">  767</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0; idx &lt; (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3); idx++) {</div>
<div class="line"><span class="lineno">  768</span>        <span class="comment">// Height</span></div>
<div class="line"><span class="lineno">  769</span>        <span class="keywordflow">if</span> (idx % (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2) == 0) k++;</div>
<div class="line"><span class="lineno">  770</span> </div>
<div class="line"><span class="lineno">  771</span>        <span class="comment">// E</span></div>
<div class="line"><span class="lineno">  772</span>        <span class="keywordflow">if</span> (idx &lt; (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)*(model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-4)) coeff.push_back(T(idx, idx+(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2), model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]/model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k]));</div>
<div class="line"><span class="lineno">  773</span>        </div>
<div class="line"><span class="lineno">  774</span>        <span class="comment">// F</span></div>
<div class="line"><span class="lineno">  775</span>        <span class="keywordflow">if</span> (idx &gt;= (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2)) coeff.push_back(T(idx, idx-(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-2), model.<a class="code hl_variable" href="classvvm.html#a7edff5662fbdb8df0fe3094a6ab3efb7">rhow</a>[k]/model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[k-1]));</div>
<div class="line"><span class="lineno">  776</span>    }</div>
<div class="line"><span class="lineno">  777</span> </div>
<div class="line"><span class="lineno">  778</span>    model.<a class="code hl_variable" href="classvvm.html#ac87ca230e4801653418101e80a986b5b">A</a>.setFromTriplets(coeff.begin(), coeff.end());</div>
<div class="line"><span class="lineno">  779</span>    </div>
<div class="line"><span class="lineno">  780</span>    <span class="comment">// ###########################################</span></div>
<div class="line"><span class="lineno">  781</span>    <span class="comment">// For solving u</span></div>
<div class="line"><span class="lineno">  782</span>    <span class="comment">// G: i = 1~model.nx-2</span></div>
<div class="line"><span class="lineno">  783</span>    <span class="comment">// ###########################################</span></div>
<div class="line"><span class="lineno">  784</span>    std::vector&lt;T&gt; coeff_xi;</div>
<div class="line"><span class="lineno">  785</span> </div>
<div class="line"><span class="lineno">  786</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-3; i++) {</div>
<div class="line"><span class="lineno">  787</span>        <span class="comment">// D</span></div>
<div class="line"><span class="lineno">  788</span>        coeff_xi.push_back(T(i, i, -2. + model.POISSONPARAMU));</div>
<div class="line"><span class="lineno">  789</span>        <span class="keywordflow">if</span> (i != model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-3) coeff_xi.push_back(T(i, i+1, 1.));</div>
<div class="line"><span class="lineno">  790</span>        <span class="keywordflow">if</span> (i != 0) coeff_xi.push_back(T(i, i-1, 1.));</div>
<div class="line"><span class="lineno">  791</span>    }</div>
<div class="line"><span class="lineno">  792</span>    <span class="comment">// Boundary</span></div>
<div class="line"><span class="lineno">  793</span>    coeff_xi.push_back(T(0, model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-3, 1.));</div>
<div class="line"><span class="lineno">  794</span>    coeff_xi.push_back(T(model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-3, 0, 1.));</div>
<div class="line"><span class="lineno">  795</span>    model.<a class="code hl_variable" href="classvvm.html#a2b0b1a4ac6932d797805238e973cc01d">G</a>.setFromTriplets(coeff_xi.begin(), coeff_xi.end());</div>
<div class="line"><span class="lineno">  796</span> </div>
<div class="line"><span class="lineno">  797</span>    <span class="comment">// Here is testing for the eigen solver</span></div>
<div class="line"><span class="lineno">  798</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  799</span><span class="comment">    // eigen solver</span></div>
<div class="line"><span class="lineno">  800</span><span class="comment">    Eigen::VectorXd x((model.nx-2)*(model.nz-3)), b((model.nx-2)*(model.nz-3)), x_ans((model.nx-2)*(model.nz-3));</span></div>
<div class="line"><span class="lineno">  801</span><span class="comment">    </span></div>
<div class="line"><span class="lineno">  802</span><span class="comment">    // b</span></div>
<div class="line"><span class="lineno">  803</span><span class="comment">    int count = 0;</span></div>
<div class="line"><span class="lineno">  804</span><span class="comment">    for (int k = 0; k &lt;= model.nz-4; k++) {</span></div>
<div class="line"><span class="lineno">  805</span><span class="comment">        for (int i = 0; i &lt;= model.nx-3; i++) {</span></div>
<div class="line"><span class="lineno">  806</span><span class="comment">            x_ans(count) = exp(sin(i+k));</span></div>
<div class="line"><span class="lineno">  807</span><span class="comment">            count++;</span></div>
<div class="line"><span class="lineno">  808</span><span class="comment">        }</span></div>
<div class="line"><span class="lineno">  809</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  810</span><span class="comment">    b = model.A * x_ans;</span></div>
<div class="line"><span class="lineno">  811</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  812</span><span class="comment">    // Eigen::SimplicialLDLT&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver;</span></div>
<div class="line"><span class="lineno">  813</span><span class="comment">    Eigen::BiCGSTAB&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver;</span></div>
<div class="line"><span class="lineno">  814</span><span class="comment">    // Eigen::ConjugateGradient&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver;</span></div>
<div class="line"><span class="lineno">  815</span><span class="comment">    solver.setTolerance(1e-20);</span></div>
<div class="line"><span class="lineno">  816</span><span class="comment">    solver.setMaxIterations(10000);</span></div>
<div class="line"><span class="lineno">  817</span><span class="comment">    Eigen::SparseMatrix&lt;double&gt; A = model.A;</span></div>
<div class="line"><span class="lineno">  818</span><span class="comment">    solver.compute(A);</span></div>
<div class="line"><span class="lineno">  819</span><span class="comment">    if (solver.info() != Eigen::Success) {</span></div>
<div class="line"><span class="lineno">  820</span><span class="comment">        std::cout &lt;&lt; &quot;WWWWWWWWW Warning!!!!!!!!!!!!&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  821</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  822</span><span class="comment">    x = solver.solve(b);</span></div>
<div class="line"><span class="lineno">  823</span><span class="comment">    if (solver.info() != Eigen::Success) {</span></div>
<div class="line"><span class="lineno">  824</span><span class="comment">        std::cout &lt;&lt; &quot;W Solve Warning!!!!!!!!!!!!&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  825</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  826</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  827</span>    </div>
<div class="line"><span class="lineno">  828</span>    <span class="comment">// std::cout &lt;&lt; &quot;#iterations:     &quot; &lt;&lt; solver.iterations() &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  829</span>    <span class="comment">// std::cout &lt;&lt; &quot;estimated error: &quot; &lt;&lt; solver.error()      &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  830</span>    <span class="comment">// std::cout &lt;&lt; ((x_ans-x).cwiseAbs()).sum() &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  831</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  832</span><span class="comment">    Eigen::VectorXd y(model.nx-2), h(model.nx-2), y_ans(model.nx-2);</span></div>
<div class="line"><span class="lineno">  833</span><span class="comment">    // h</span></div>
<div class="line"><span class="lineno">  834</span><span class="comment">    for (int i = 0; i &lt;= model.nx-3; i++) {</span></div>
<div class="line"><span class="lineno">  835</span><span class="comment">        y_ans(i) = exp(sin(i));</span></div>
<div class="line"><span class="lineno">  836</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  837</span><span class="comment">    h = model.G * y_ans;</span></div>
<div class="line"><span class="lineno">  838</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  839</span><span class="comment">    Eigen::SparseMatrix&lt;double&gt; G = model.G;</span></div>
<div class="line"><span class="lineno">  840</span><span class="comment">    // Eigen::ConjugateGradient&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver_xi;</span></div>
<div class="line"><span class="lineno">  841</span><span class="comment">    // Eigen::BiCGSTAB&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver_xi;</span></div>
<div class="line"><span class="lineno">  842</span><span class="comment">    Eigen::SimplicialLDLT&lt;Eigen::SparseMatrix&lt;double&gt; &gt; solver_xi;</span></div>
<div class="line"><span class="lineno">  843</span><span class="comment">    // solver_xi.setTolerance(1e-20);</span></div>
<div class="line"><span class="lineno">  844</span><span class="comment">    solver_xi.compute(G);</span></div>
<div class="line"><span class="lineno">  845</span><span class="comment">    if (solver_xi.info() != Eigen::Success) {</span></div>
<div class="line"><span class="lineno">  846</span><span class="comment">        std::cout &lt;&lt; &quot;Decompose Warning!!!!!!!!!!!!&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  847</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  848</span><span class="comment">    y = solver_xi.solve(h);</span></div>
<div class="line"><span class="lineno">  849</span><span class="comment">    if (solver_xi.info() != Eigen::Success) {</span></div>
<div class="line"><span class="lineno">  850</span><span class="comment">        std::cout &lt;&lt; &quot;U Solve Warning!!!!!!!!!!!!&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  851</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno">  852</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  853</span><span class="comment">    std::cout &lt;&lt; ((y_ans-y).cwiseAbs()).sum() &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  854</span><span class="comment">    */</span>  </div>
<div class="line"><span class="lineno">  855</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  856</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  857</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><!-- SVG 5 --></div>
</div>

</div>
</div>
<a id="abcc07bc7fb43a3081b2a7d68c8a34782" name="abcc07bc7fb43a3081b2a7d68c8a34782"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcc07bc7fb43a3081b2a7d68c8a34782">&#9670;&#160;</a></span>pubarTop_pt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void vvm::PoissonSolver::pubarTop_pt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvvm.html">vvm</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>model</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="PoissonSolver_8cpp_source.html#l00646">646</a> of file <a class="el" href="PoissonSolver_8cpp_source.html">PoissonSolver.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  646</span>                                             {</div>
<div class="line"><span class="lineno">  647</span>    <span class="keywordtype">double</span> rhouwUp = 0., rhouwDown = 0.;</div>
<div class="line"><span class="lineno">  648</span>    <span class="keywordtype">double</span> prhouwb_pz_rhob = 0.;</div>
<div class="line"><span class="lineno">  649</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a>-1; i++) {</div>
<div class="line"><span class="lineno">  650</span>        rhouwUp += 0.25 * (model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-1]*model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-1] + model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2]*model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2]) * (model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-1] + model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i-1][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-1]);</div>
<div class="line"><span class="lineno">  651</span>        rhouwDown += 0.25 * (model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2]*model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2] + model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3]*model.<a class="code hl_variable" href="classvvm.html#a1ac0d1c50fc3935a312b6f667a1c34c0">u</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-3]) * (model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2] + model.<a class="code hl_variable" href="classvvm.html#a03a120f9647d1b680a8552a1743f47bf">w</a>[i-1][model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2]);</div>
<div class="line"><span class="lineno">  652</span>    }</div>
<div class="line"><span class="lineno">  653</span>    rhouwUp /= ((double) (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a> - 2.));</div>
<div class="line"><span class="lineno">  654</span>    rhouwDown /= ((double) (model.<a class="code hl_variable" href="classvvm.html#a54019773003b18a98f267df45ee230bb">nx</a> - 2.));</div>
<div class="line"><span class="lineno">  655</span>    prhouwb_pz_rhob = (rhouwUp - rhouwDown) * model.<a class="code hl_variable" href="classvvm.html#a68ea5e54b9a54c4256969b5ba5dd4cbd">rdz</a> / model.<a class="code hl_variable" href="classvvm.html#af25e3367c5ad1d011c15ff7d774a0abf">rhou</a>[model.<a class="code hl_variable" href="classvvm.html#a1c19d7dc2ab861379c3c69c7e79bd5c8">nz</a>-2];</div>
<div class="line"><span class="lineno">  656</span>    model.<a class="code hl_variable" href="classvvm.html#a2494ade44221bcd3aed164d73bf208f4">ubarTopp</a> = model.<a class="code hl_variable" href="classvvm.html#a418daede3a9c0ed998842ff792647f2f">ubarTopm</a> + model.<a class="code hl_variable" href="classvvm.html#a35038a3310f0394ec73c928ff9801f84">d2t</a> * (-prhouwb_pz_rhob);</div>
<div class="line"><span class="lineno">  657</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  658</span>}</div>
<div class="ttc" id="aclassvvm_html_a35038a3310f0394ec73c928ff9801f84"><div class="ttname"><a href="classvvm.html#a35038a3310f0394ec73c928ff9801f84">vvm::d2t</a></div><div class="ttdeci">double d2t</div><div class="ttdoc">From Config_VVM given by users.</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00276">Declare.hpp:276</a></div></div>
<div class="ttc" id="aclassvvm_html_a418daede3a9c0ed998842ff792647f2f"><div class="ttname"><a href="classvvm.html#a418daede3a9c0ed998842ff792647f2f">vvm::ubarTopm</a></div><div class="ttdeci">double ubarTopm</div><div class="ttdoc">The top boundary of the zonal wind for future time step. In the model design part,...</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00303">Declare.hpp:303</a></div></div>
<div class="ttc" id="aclassvvm_html_a68ea5e54b9a54c4256969b5ba5dd4cbd"><div class="ttname"><a href="classvvm.html#a68ea5e54b9a54c4256969b5ba5dd4cbd">vvm::rdz</a></div><div class="ttdeci">double rdz</div><div class="ttdoc">1 / dz, calculated from Config_VVM given by users.</div><div class="ttdef"><b>Definition</b> <a href="Declare_8hpp_source.html#l00269">Declare.hpp:269</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><!-- SVG 6 --></div>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ade65a218fe6088b4591c6c51a8f13134" name="ade65a218fe6088b4591c6c51a8f13134"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade65a218fe6088b4591c6c51a8f13134">&#9670;&#160;</a></span>A</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Eigen::SparseMatrix&lt;double&gt; vvm::PoissonSolver::A</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="Declare_8hpp_source.html#l00475">475</a> of file <a class="el" href="Declare_8hpp_source.html">Declare.hpp</a>.</p>

</div>
</div>
<a id="aa57bc9d4bc2a52dbcd1147afdd621bfc" name="aa57bc9d4bc2a52dbcd1147afdd621bfc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa57bc9d4bc2a52dbcd1147afdd621bfc">&#9670;&#160;</a></span>G</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Eigen::SparseMatrix&lt;double&gt; vvm::PoissonSolver::G</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="Declare_8hpp_source.html#l00476">476</a> of file <a class="el" href="Declare_8hpp_source.html">Declare.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/Aaron/TMIF_VVM_CSSWM/2DVVM/src/<a class="el" href="Declare_8hpp_source.html">Declare.hpp</a></li>
<li>/home/Aaron/TMIF_VVM_CSSWM/2DVVM/src/<a class="el" href="PoissonSolver_8cpp_source.html">PoissonSolver.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classvvm.html">vvm</a></li><li class="navelem"><a class="el" href="classvvm_1_1PoissonSolver.html">PoissonSolver</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
